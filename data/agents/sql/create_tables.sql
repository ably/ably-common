-- Create table for agents data
CREATE OR REPLACE TABLE AGENTS (
    IDENTIFIER VARCHAR(100) PRIMARY KEY,
    VERSIONED BOOLEAN NOT NULL,
    TYPE VARCHAR(20) NOT NULL,
    SOURCE VARCHAR(500),
    PRODUCT VARCHAR(50),
    NAME VARCHAR(200) NOT NULL,
    -- Metadata columns
    LOADED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    UPDATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP()
);

-- Create table for agent release data
CREATE OR REPLACE TABLE AGENT_RELEASES (
    IDENTIFIER VARCHAR(100) NOT NULL,
    VERSION VARCHAR(50) NOT NULL,
    RELEASE_DATE DATE,
    RELEASE_TYPE VARCHAR(20),
    SUPPORT_END_DATE DATE,
    DEPRECATION_DATE DATE,
    SUNSET_DATE DATE,
    SUNSET_REASON VARCHAR(500),
    LATEST_VERSION VARCHAR(50),
    LATEST_VERSION_RELEASE_DATE DATE,
    RELEASE_INFO_SUMMARY VARCHAR(500),
    RELEASE_INFO VARCHAR(16777216), -- Max VARCHAR size in Snowflake
    -- Metadata columns
    LOADED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    UPDATED_AT TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    -- Composite primary key
    PRIMARY KEY (IDENTIFIER, VERSION),
    -- Foreign key to agents table
    FOREIGN KEY (IDENTIFIER) REFERENCES AGENTS(IDENTIFIER)
);

-- Create staging tables for loading data
CREATE OR REPLACE TABLE AGENTS_STAGING LIKE AGENTS;
CREATE OR REPLACE TABLE AGENT_RELEASES_STAGING LIKE AGENT_RELEASES;

-- Create file formats for CSV loading
CREATE OR REPLACE FILE FORMAT CSV_FORMAT
    TYPE = CSV
    FIELD_DELIMITER = ','
    FIELD_OPTIONALLY_ENCLOSED_BY = '"'
    SKIP_HEADER = 1
    NULL_IF = ('', 'NULL', 'null')
    EMPTY_FIELD_AS_NULL = TRUE
    ESCAPE_UNENCLOSED_FIELD = NONE;

-- Create stages for loading files (if using internal stage)
CREATE OR REPLACE STAGE AGENT_DATA_STAGE
    FILE_FORMAT = CSV_FORMAT;